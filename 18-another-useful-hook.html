<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>另一个实用 Hook | Claude Code 实战课程</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="brand" href="index.html">Claude Code 实战课程（中文）</a>
        <span class="subtitle">第 18 节 · 另一个实用 Hook</span>
      </div>
    </header>

<div class="layout">
<aside class="sidebar" id="sidebar"></aside>
  <div class="main">

    <nav class="lesson-nav container">
      <a href="17-useful-hooks.html">上一节</a>
      <a href="index.html">目录</a>
      <a href="19-the-claude-code-sdk.html">下一节</a>
    </nav>

    <main class="container content">
      <div class="content-card">
        <h1>另一个实用 Hook</h1>
        <div class="lesson-meta">
          原文链接：
          <a href="https://anthropic.skilljar.com/claude-code-in-action/312427"
            >https://anthropic.skilljar.com/claude-code-in-action/312427</a
          >
          <span class="tag">讲义</span>
        </div>
        <div class="content-body">
          <p>除 PreToolUse 与 PostToolUse 外，还有更多 Hook 类型：</p>
          <ul>
            <li><code>Notification</code>：Claude 请求工具权限或 60 秒空闲时触发</li>
            <li><code>Stop</code>：Claude 回复结束时触发</li>
            <li><code>SubagentStop</code>：子代理任务结束时触发</li>
            <li><code>PreCompact</code>：compact 操作前触发</li>
            <li><code>UserPromptSubmit</code>：用户提交提示词时触发</li>
            <li><code>SessionStart</code>：会话开始或恢复时触发</li>
            <li><code>SessionEnd</code>：会话结束时触发</li>
          </ul>

          <p><strong>令人困惑的地方在于：</strong></p>
          <ol>
            <li>不同 Hook 的标准输入结构完全不同</li>
            <li>PreToolUse/PostToolUse 的输入还会随工具类型变化</li>
          </ol>

          <p>例如，下面是一个 PostToolUse（监听 TodoWrite）的输入：</p>
          <pre><code>{
  "session_id": "9ecf22fa-edf8-4332-ae85-b6d5456eda64",
  "transcript_path": "&lt;path_to_transcript&gt;",
  "hook_event_name": "PostToolUse",
  "tool_name": "TodoWrite",
  "tool_input": {
    "todos": [{ "content": "write a readme", "status": "pending", "priority": "medium", "id": "1" }]
  },
  "tool_response": {
    "oldTodos": [],
    "newTodos": [{ "content": "write a readme", "status": "pending", "priority": "medium", "id": "1" }]
  }
}</code></pre>

          <p>而 Stop Hook 的输入是：</p>
          <pre><code>{
  "session_id": "af9f50b6-f042-4773-b3e2-c3a4814765ce",
  "transcript_path": "&lt;path_to_transcript&gt;",
  "hook_event_name": "Stop",
  "stop_hook_active": false
}</code></pre>

          <p>
            可以看到，不同 Hook 的输入差异非常大，这使得编写 Hook 变得困难——你不一定知道该解析哪些字段。
          </p>

          <p>建议做一个辅助 Hook 来记录输入：</p>
          <pre><code>"PostToolUse": [ // Or "PreToolUse" or "Stop", etc
  {
    "matcher": "*",
    "hooks": [
      {
        "type": "command",
        "command": "jq . > post-log.json"
      }
    ]
  },
]</code></pre>
          <p>
            该命令会把 Hook 输入写入 <code>post-log.json</code>，方便你观察真实结构，从而更容易编写稳定的 Hook。
          </p>
        </div>
      </div>
    </main>

    <footer class="site-footer container">
      下一节：<a href="19-the-claude-code-sdk.html">Claude Code SDK</a>
    </footer>
    </div>
</div>
<script src="sidebar.js"></script>
</body>
</html>

